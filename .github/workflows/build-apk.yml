name: Let Buildozer Download Everything

on:
  push:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-22.04
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup
      run: |
        sudo apt update
        sudo apt install -y python3-pip
        pip3 install buildozer
    
    - name: Create minimal spec
      run: |
        # Минимальный конфиг - buildozer сам скачает нужные версии
          cat > buildozer.spec << 'EOF'
        [app]
        title = App
        package.name = app
        package.domain = org.test
        source.dir = .
        version = 1.0
        requirements = python3
        android.api = 30
        android.minapi = 21
        android.archs = armeabi-v7a

        [buildozer]
        warn_on_root = 0
        log_level = 2
        android.accept_sdk_license = True
        EOF
                
        echo 'print("Hello")' > main.py
    
    - name: Build with auto-download
      run: |
        # Buildozer сам скачает SDK с правильными версиями
        buildozer android debug 2>&1 | tail -50
    
    - uses: actions/upload-artifact@v4
      with:
        name: apk-result
        path: bin/*.apk